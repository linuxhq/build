---
monit_daemon: 60
monit_eventqueue_basedir: /tmp
monit_eventqueue_slots: 64

monit_exec:
  - name: discord.sh
    base64: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      64386165643433333464323363343337613061636435353963656661393761396532376564613939
      6633353031623734386130636336373661653561616665360a386563396262623636366432396666
      36653764663532383632396632646635636266666339663465613632663065393631336233333265
      6263313663646636370a393930333463646561613539633335326137633738613833366261366262
      38616236353965346262386434633464316338316235626537333864346439336637613536663838
      34303166643163626536313738343937383866643330643464353339343133303765373563623063
      66623765633664376434333134616634643538646433303463663134363438616363353638646336
      30333966623764393634613265323635643965363836393538393237636163333464383634316464
      31616332633032343132666637396661393461326534306266656436373365353965373933363432
      32346230636462376465623463636537316631343463326464393763396339303066316132363266
      34366461613461323137333465616565383535323564363761313231613536373339333433353462
      62616130356537383163363864356638333466393566646332333665656330663962366339646361
      33646330643332316233353965613034666632326562323737366630363066363238643434333164
      65656531343964326432376132303463313561643863666665356364353961626131313230626366
      35643464353964343333346530306530623366626337393439646363633239633932323433666133
      31666631376335663430336138366239666237666434356139636432303861313638643165353461
      38646233393935363764363534313031316632663762313939303836363438366236333536633733
      36353434646562653130353065373930363230333566623430343734653065373265666139306630
      64363465386439663835393335613637376638386562373764643331636564353266343630393932
      37613062363135666633633031633564383234643433663834363932323734623530363136393433
      33643534343666313861666132333635656264653666303565613130343436313439326430316631
      34366265373738333138343734646538396638653063363939373738636439353735653839626539
      31653039616235393161396638653533666166396238653438333466656161393338313534393963
      38643362633536303266303037386538323963303131316135613430653238636532616639386435
      35306366653134353237386632353731643865623164356366663563396566373961373132626134
      61336661333964353138393135306662396637343738333237343764643061326466623865393262
      65643364323466383739363531343431653064316465623731666265646661633637323434366533
      32393065623032666130383037663865306234653237306138383130386166383138326564626134
      38653536653837336633323264663733663532316639303939626138393830643535613338656436
      32393165316663346634376535356236313465613135323665623366616561353830346635623364
      33653330313338373265386332356132656533316635653430363939383966653437316662663933
      34643036636362663663313139366439353331313666326534323338663936316137396332646665
      62636365363830326230643938373730623266653961383539306361313531326262653531333231
      35313539653466353830623665376337663164623030323835316431363064663062343232636537
      65623064393231653462646639353836366436623039383437653531313965373430396635323034
      32663631393666653939303961643630313864363662376565313238333036383961393863356230
      34366236313735633137353136626138313664633166633166623366326630346461

monit_start_delay: 120
monit_httpd:
  - unixsocket /var/run/monit.sock
  - allow localhost

monit_filesystem:
  - name: root
    rules:
      - path /
      - if space usage gt 80% for 5 cycles then exec /opt/monit/bin/discord.sh

monit_process:
  - name: containerd
    rules:
      - matching containerd
      - if does not exist then exec /opt/monit/bin/discord.sh

  - name: docker
    rules:
      - matching docker
      - if does not exist then exec /opt/monit/bin/discord.sh

  - name: kopia
    rules:
      - matching kopia
      - if does not exist then exec /opt/monit/bin/discord.sh

  - name: sshd
    rules:
      - matching sshd
      - if does not exist then exec /opt/monit/bin/discord.sh

monit_program:
  - name: cloudflared
    rules:
      - path /usr/bin/systemctl --quiet is-active 'cloudflared@*.service'
      - if status ne 0 for 5 cycles then exec /opt/monit/bin/discord.sh

  - name: docker-compose
    rules:
      - path /usr/bin/systemctl --quiet is-active 'docker-compose@*.service'
      - if status ne 0 for 5 cycles then exec /opt/monit/bin/discord.sh
...
